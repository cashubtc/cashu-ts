# One-liner setup / teardown for CDK Mint + Keycloak demo

COMPOSE = docker compose
DEMO_CMD = npx tsx auth_password_example.ts
DEMO_DEVA = npx tsx auth_device_example.ts
DEMO_PKCE = npx tsx auth_pkce_example.ts


# Default target
.PHONY: demo-ci
demo-ci:
	$(COMPOSE) up -d --force-recreate
	@sleep 20
	$(DEMO_CMD)
	$(COMPOSE) down -v

up:
	@echo "ðŸš€ Starting Keycloak + Mint containers..."
	$(COMPOSE) up -d --force-recreate
	@echo "âŒ› Waiting for Keycloak to be ready (approx 10s)..."
	@sleep 10
	@echo "âœ… Containers started. Run 'make demo' to execute the auth flow."

down:
	@echo "ðŸ§¹ Stopping and removing containers..."
	$(COMPOSE) down -v

logs:
	$(COMPOSE) logs -f

demo:
	@echo "ðŸ§ª Running PASSWORD Auth demo..."
	$(DEMO_CMD)

demo-device:
	@echo "ðŸ§ª Running DEVICE Auth demo..."
	$(DEMO_DEVA)

demo-pkce:
	@echo "ðŸ§ª Running PKCE Auth demo..."
	$(DEMO_PKCE)

clean: down
	@echo "ðŸ§½ Removing any leftover volumes..."
	docker volume prune -f
