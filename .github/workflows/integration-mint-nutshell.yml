name: Nutshell integration

on: [push, pull_request]

jobs:
  integration-tests:
    uses: ./.github/workflows/integration-against-mint.yml
    with:
      image: cashubtc/nutshell:0.18.1
      port: 3338
      container_name: nutshell
      envs: |
        MINT_LIGHTNING_BACKEND=FakeWallet
        MINT_INPUT_FEE_PPK=100
        MINT_LISTEN_HOST=0.0.0.0
        MINT_LISTEN_PORT=3338
        MINT_PRIVATE_KEY=TEST_PRIVATE_KEY
        FAKEWALLET_DELAY_PAYMENT=TRUE
        FAKEWALLET_DELAY_INCOMING_PAYMENT=1
        FAKEWALLET_DELAY_OUTGOING_PAYMENT=1
        MINT_TRANSACTION_RATE_LIMIT_PER_MINUTE=100
      cmd: 'poetry run mint'
